<head>
    <style>
        table {
            user-select: none;
        }
        .grid-container {
            display: grid;
            grid-template-rows: auto auto auto auto; /* Creates three rows */
            grid-template-columns: 1fr 1fr 1fr; /* Creates two columns */
            background-color: brown;
        }
        #button_container {
            display: flex;
            justify-content: space-between;
            grid-row:4;
            grid-column: 1 / span 3;
            background-color: coral;
        }
        
        #back_button {
            margin-left: 10px;
            font-size: 40px;
        }
        
        #next_button {
            margin-right: 10px;
            font-size: 40px;
        }

        #welcome_view{
            grid-column: 3; /* Places these divs in the first column */
            grid-row: 1 / span 2;
            background-color: red;
            display: flex; /* Enable Flexbox */
            flex-direction: column;
            justify-content: space-between;
            align-items: center; /* Add this line */
        }
        #welcome_message{
            font-size: 3vw; /* Adjust as needed */
            margin-bottom: 0;
            margin-top: 0;
        }
        #game_rules{
            font-size: 3vw; /* Adjust as needed */
            margin-bottom: 0;
            margin-top: 2vh;
        }
        #free_space_message{
            font-size: 2vw; /* Adjust as needed */
            margin-bottom: 0;
            margin-top: 2vh;
        }
        #game_name{
            grid-column: 1 / span 2; /* Places these divs in the first column */
            grid-row: 1;
            background-color: aqua;
            display: flex; /* Enable Flexbox */
            justify-content: center; /* Center horizontally */
            align-items: center; /* Center vertically */
            font-size: 3vw; /* Adjust as needed */
            margin-bottom: 0;
            margin-top: 0;
        }

        #full_view{
            grid-column: 1 / span 2; /* Places these divs in the first column */
            grid-row: 2;
            background-color: blue;
            display: flex; /* Enable Flexbox */
            justify-content: center; /* Center horizontally */
            align-items: center; /* Center vertically */
            min-height: 70vh;
            max-height: 70vh;
        }
        #full_table td{
            font-size: 10vh; /* Adjust as needed */
            padding: 0 2vw; /* Adjust as needed */
            border: 1px solid black; /* Adjust as needed */
        }
        /* Games require pattern on both boards */
        .full_table_multi{
            margin-left: 20px;
        }
        .full_table_multi td{
            font-size: 6vh; /* Adjust as needed */
            padding: 0 2vw; /* Adjust as needed */
            border: 1px solid black; /* Adjust as needed */
        }

        #games_preview{
            grid-column: 1 / span 3; /* Places these divs in the second column */
            grid-row: 3;
            background-color: green;
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            justify-content: center; /* Horizontally center the tables */
        }
        #games_preview table {
            margin-right: 5vw; /* Adjust as needed */
        }
        
        #preview_table td{
            border: 1px solid black; /* Adjust as needed */
            padding: 0 1vw; /* Adjust as needed */
        }
        
    </style>
    <script>
        function bingo(){
            return {
                "name": "Normal Bingo",
                "board_count": 1,
                "board": [
                    [0,0],[1,1],[2,2],[3,3],[4,4]
                ],
                "free_space_dynamic": true,
                "free_off_board": [
                    [0, 0], [0,1],[0,2],[0,3],[0,4]
                ],
                "transitional": false,
                "rules": "Must get 5 in a row"
            };
        }
        function tinyX(){
            return {
                "name": "Tiny X",
                "board_count": 1,
                "board": [
                    [0,0],[0,2],[1,1],[2,0],[2,2]
                ],
                "free_space_dynamic": false,
                "free_space_on": true,
                "transitional": false,
                "rules": "Must get the tiny x pattern any where on the board"
            };
        }
        function EightCorners(){
            return {
                "name": "Eight Corners",
                "board_count": 2,
                "board": [
                    [
                        [0,0],[4,4],[0,4],[4,0]
                    ],
                    [
                        [0,0],[4,4],[0,4],[4,0]
                    ]
                ],
                "free_space_dynamic": false,
                "free_space_on": false,
                "transitional": false,
                "rules": "Must get all 4 corners on BOTH boards"
            };
        }
        function FourCorners(){
            return {
                "name": "Four Corners",
                "board_count": 1,
                "board":
                [
                    [0,0],[4,4],[0,4],[4,0]
                ],
                "free_space_dynamic": false,
                "free_space_on": false,
                "transitional": false,
                "rules": "Must get all 4 corners on BOTH boards"
            };
        }
        
        function RailRoadTracks(){
            return {
                "name": "Railroad Tracks",
                "board": 
                [
                    [0,1],[1,1],[2,1],[3,1],[4,1], // I Row
                    [1,2],[3,2],//N Row
                    [0,3],[1,3],[2,3],[3,3],[4,3] // 0 Row
                ],
                "free_space_dynamic": false,
                "free_space_on": false,
                "transitional": false,
                "rules": "Must get exact pattern"
            };
        }
        function InsideCircle(){
            return {
                "name": "Inside Circle",
                "board": 
                [
                    [1,1],[1,2],[1,3], // top Row
                    [2,1],[2,3],//middle
                    [3,1],[3,2],[3,3] // bottom Row
                ],
                "free_space_dynamic": false,
                "free_space_on": false,
                "transitional": false,
                "rules": "Must get exact pattern"
            };
        }
        function OutsideCircle(){
            return {
                "name": "Outside Circle",
                "board": 
                [
                    [0,0],[0,1],[0,2],[0,3],[0,4], // top Row
                    [1,0],[1,4],
                    [2,0],[2,4],
                    [3,0],[3,4],
                    [4,0],[4,1],[4,2],[4,3],[4,4] // bottom Row
                ],
                "free_space_dynamic": false,
                "free_space_on": false,
                "transitional": false,
                "rules": "Must get exact pattern"
            };
        }
        function PostageStamp(){
            return {
                "name": "Postage Stamp",
                "board": 
                [
                    [0,0],[0,1],[0,3],[0,4], // top Row
                    [1,0],[1,1],[1,3],[1,4],
                    [3,0],[3,1],[3,3],[3,4],
                    [4,0],[4,1],[4,3],[4,4],
                ],
                "free_space_dynamic": false,
                "free_space_on": false,
                "transitional": false,
                "rules": "Must get exact pattern"
            };
        }
        function TheGoat(){
            return {
                "name": "The GOAT",
                "board": 
                [
                    [
                        [0,0],[0,1],[0,2],[0,3], // top Row
                        [1,0],
                        [2,0],[2,2],[2,3],
                        [3,0],[3,4]
                        [4,0],[4,1],[4,2],[4,3]
                    ],
                    [
                        [0,1],[0,2],[0,3],[0,4], // top Row
                        [1,1],
                        [2,1],[2,3],[2,4],
                        [3,1],[3,4]
                        [4,1],[4,2],[4,3],[4,4]
                    ]
                ],
                "free_space_dynamic": true,
                "free_space_on": true,
                "transitional": false,
                "rules": "Must get exact pattern, may shift 1 to right"
            };
        }
        function games(){
            return [
                bingo(),
                tinyX(),
                EightCorners(),
                FourCorners(),
                RailRoadTracks(),
                InsideCircle(),
                OutsideCircle(),
                PostageStamp(),
                TheGoat()
            ]
        }

        var current_game = 0;
        var preview_index = 0;
        var free_space_on = true;
        const bingo_word = 'bingo';


        function create_table( parent, name , game, free_font_size = '3vh' )
        {
            var table = parent.createElement('table');
            table.id = name;
            
            // Create 5 rows
            for (var i = 0; i < 5; i++) {
                var tr = parent.createElement('tr');

                // Create 5 columns
                for (var j = 0; j < 5; j++) {
                    var td = parent.createElement('td');

                    // Fill the cell with the corresponding character from the word
                    td.textContent = bingo_word[j].toUpperCase();
                    if( i == 2 && j == 2 ){
                        td.textContent = "FREE";
                        td.style.fontSize = free_font_size;
                    }
                    td.style.textAlign="center";

                    if( game_contains_point( game, i, j ) )
                    {
                        td.style.backgroundColor = "red";
                    }

                    // Add the cell to the row
                    tr.appendChild(td);
                }

                // Add the row to the table
                table.appendChild(tr);
            }
            return table;
        }

        function game_contains_point( game, x, y, board_num = 0 )
        {
            var board = free_space_on ? game.board : game.free_off_board;
            if (!game.free_space_dynamic)
            {
                board = game.board;
            }

            if (game.board_count > 1)
            {
                board = board[board_num];
            }

            for( var i = 0; i < board.length; i++ ){
                if( board[i][0] == x && board[i][1] == y ){
                    return true;
                }
            }
            return false;
        }

        function update_main_board_num(active_game, board_name, board_num) 
        {
            console.log(`Updating ${board_name}`);
            var table = document.getElementById(board_name);
            for (var i = 0; i < 5; i++) {
                for (var j = 0; j < 5; j++) {
                    var td = table.rows[i].cells[j];
                    if( i == 2 && j == 2 ){
                        td.textContent = "FREE";
                        td.style.fontSize = '3vh';
                    }
                    else{
                        td.textContent = bingo_word[j].toUpperCase();
                    }
                    if( game_contains_point( active_game, i, j, board_num ) )
                    {
                        console.log(`Setting ${i},${j} to red`)
                        td.style.backgroundColor = "red";
                    }
                    else{
                        td.style.backgroundColor = "white";
                    }
                }
            }

        }
        function hide_board(board_name)
        {
            console.log(`Hiding ${board_name}`);
            var table = document.getElementById(board_name);
            table.style.display = 'none';
        }
        function show_board(board_name)
        {
            console.log(`Showing ${board_name}`);
            var table = document.getElementById(board_name);
            table.style.display = 'block';
        }
        function update_main_board() 
        {
            //TODO Support multi board game
            console.log(`Updating main board ${current_game}`);
            var active_game = games()[current_game];
            console.log(`Updating main board for ${active_game.name}`);
            if( active_game.board_count == 2 )
            {
                console.log(`Double board game`);
                hide_board('full_table');
                show_board('full_table_0');
                show_board('full_table_1');
                update_main_board_num(active_game, 'full_table_0', 0);
                update_main_board_num(active_game, 'full_table_1', 1);
            }
            else
            {
                console.log(`Single board game`);
                hide_board('full_table_0');
                hide_board('full_table_1');
                show_board('full_table');
                update_main_board_num(active_game, 'full_table', 0);
            }
            var free_space_message = document.getElementById('free_space_message');

            if(active_game.free_space_dynamic)
            {
                free_space_message.innerHTML = free_space_on ? 'Free space is ON' : 'Free space is OFF';
            }
            else
            {
                free_space_message.innerHTML = active_game.free_space_on ? 'Free space is ON' : 'Free space is OFF';
            }
            var rules = document.getElementById('game_rules');
            rules.innerHTML = active_game.rules;
            var game_name = document.getElementById('game_name');
            game_name.innerHTML = active_game.name;
        }

        function update_preview()
        {
            var games_preview = document.getElementById('games_preview');
            var tables = games_preview.querySelectorAll('table');
            var labels = games_preview.querySelectorAll('p');
            console.log(`tables ${tables.length}`);
            console.log(`labels ${tables.length}`);
            var active_games = getFiveGames(preview_index);
            for( var k = 0; k < tables.length; ++k )
            {
                var table = tables[k]
                for (var i = 0; i < 5; i++) {
                    for (var j = 0; j < 5; j++) {
                        var td = table.rows[i].cells[j];
                        if( i == 2 && j == 2 ){
                            td.textContent = "FREE";
                            td.style.fontSize = '10px';
                        }
                        else{
                            td.textContent = bingo_word[j].toUpperCase();
                        }
                        if( game_contains_point( active_games[k], i, j, 0 ) )
                        {
                            td.style.backgroundColor = "red";
                        }
                        else{
                            td.style.backgroundColor = "white";
                        }
                    }
                }
                var index =( k + preview_index ) % games().length;
                table.setAttribute('data-game', index)
                labels[k].innerHTML = active_games[k].name;
            }
        }

        function getFiveGames(index) {
            var allGames = games();
            var gameCount = allGames.length;
            var selectedGames = [];
        
            for (var i = 0; i < 5; i++) {
                var gameIndex = (index + i) % gameCount;
                selectedGames.push(allGames[gameIndex]);
            }
        
            return selectedGames;
        }

        window.onload = function() {

            var game_s = games();
            var games_preview = document.getElementById('games_preview');

            var preview_games = getFiveGames(preview_index)
            // Define the word
            for( var k = 0; k < preview_games.length; k++){
                var game = game_s[k];
                var div = document.createElement('div');
                var table = create_table( document, 'preview_table', game_s[k], '10px' );

                var game_name_label = document.createElement('p');
                game_name_label.id = 'game_preview_name';
                game_name_label.innerHTML = game.name;
                // Add the table to the body of the document
                div.appendChild(table);
                div.appendChild(game_name_label);
                games_preview.appendChild(div);

                table.setAttribute('data-game', k);
                // Add click event listener to the table
                table.addEventListener('click', function(event) {
                    // This function will be called when the table is clicked
                    // event.target refers to the clicked cell
                    //get data-game for selected table
                    var game_num = event.currentTarget.getAttribute('data-game');
                    current_game = game_num;
                    console.log('Table clicked ' + game_num);
                    update_main_board();
                });
            }


            var full_table_name = game_s[current_game].board_count == 2 ? 'full_table_0' : 'full_table';
            var full_view = document.getElementById('full_view');
            var table = create_table( document, 'full_table', game_s[current_game] );
            table.addEventListener('click', function(event) {
                // This function will be called when the table is clicked
                // event.target refers to the clicked cell
                //get data-game for selected table
                var game = game_s[current_game];
                console.log('Checking if game can have free space off ' + game.free_space_dynamic + ' free_space_on ' + free_space_on);
                if (game.free_space_dynamic){
                    free_space_on=!free_space_on;
                }
                update_main_board();
            });
            // Add the table to the body of the document
            full_view.appendChild(table);

            //Now add two more tables for double table gamess
            var table1 = create_table( document, 'full_table_0', game_s[current_game] );
            table1.addEventListener('click', function(event) {
                // This function will be called when the table is clicked
                // event.target refers to the clicked cell
                //get data-game for selected table
                var game = game_s[current_game];
                console.log('Checking if game can have free space off ' + game.free_space_dynamic + ' free_space_on ' + free_space_on);
                if (game.free_space_dynamic){
                    free_space_on=!free_space_on;
                }
                update_main_board();
            });
            table1.classList.add('full_table_multi');
            full_view.appendChild(table1);
            //Now add two more tables for double table gamess
            var table2 = create_table( document, 'full_table_1', game_s[current_game] );
            table2.addEventListener('click', function(event) {
                // This function will be called when the table is clicked
                // event.target refers to the clicked cell
                //get data-game for selected table
                var game = game_s[current_game];
                console.log('Checking if game can have free space off ' + game.free_space_dynamic + ' free_space_on ' + free_space_on);
                if (game.free_space_dynamic){
                    free_space_on=!free_space_on;
                }
                update_main_board();
            });
            table2.classList.add('full_table_multi');
            full_view.appendChild(table2);
            if( game_s[current_game].board_count != 2 )
            {
                table1.style.display = 'none';
                table2.style.display = 'none';
            }
            
            var game_name = document.getElementById('game_name');
            var game_name_label = document.createElement('p');
            game_name_label.id = 'game_name';
            game_name_label.innerHTML = game_s[current_game].name;
            game_name.appendChild(game_name_label);

            update_main_board()

            var back_button = document.getElementById('back_button');
            //listen for clicks on back button
            back_button.addEventListener('click', function(){
                if( preview_index === 0 )
                {
                    preview_index = 6;
                }
                preview_index = ( preview_index - 1 ) % 5;
                update_preview();
            });
            var nexut_button = document.getElementById('nexut_button');
            next_button.addEventListener('click', function(){
                preview_index = ( preview_index + 1 ) % 5;
                update_preview();
            });
        }
    </script>
</head>
<body>
    <body>
        <div class="grid-container">
            <div id="game_name"></div>
             <div id="welcome_view">
                <p id="welcome_message">BINGO FREE TO PLAY! 2 CARDS PER PERSON START TIME - 6:30<br> Bingo Word: BAHHH! </p>
                <p id="game_rules">Rules of the game....</p>
                <p id="free_space_message">Free space is OFF</p>
            </div>
            <div id="full_view"></div>
            <div id="games_preview"></div>
            <div id="button_container">
                <button id="back_button">Back</button>
                <button id="next_button">Next</button>
            </div>
        </div>
    </body>
</body>